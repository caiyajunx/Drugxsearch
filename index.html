<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 垂直领域搜索工具 (v3.2)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-background text-foreground font-sans antialiased">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">

        <div id="settings-view" class="view-container max-w-3xl mx-auto">
            <div class="card">
                <div class="card-header">
                    <h1 class="card-title">配置中心</h1>
                    <p class="card-description">配置AI模型、搜索引擎和其他API密钥。您的密钥将安全地存储在浏览器本地。</p>
                </div>
                <form id="settings-form">
                    <div class="card-content space-y-6">
                        <div class="space-y-4 p-4 border border-border rounded-lg">
                            <h3 class="text-lg font-semibold tracking-tight">AI 模型配置</h3>
                            <p class="text-sm text-muted-foreground">添加并管理您要使用的AI模型。您可以混合使用 Gemini 和任何兼容 OpenAI API 的模型（如 DeepSeek）。</p>
                            <div id="ai-endpoints-container" class="space-y-4"></div>
                            <button type="button" id="add-ai-endpoint-btn" class="button button-outline button-sm w-full mt-2">
                                + 添加一个AI模型
                            </button>
                        </div>

                        <div class="space-y-4 p-4 border border-border rounded-lg">
                            <h3 class="text-lg font-semibold tracking-tight">AI 任务分配</h3>
                            <p class="text-sm text-muted-foreground">为研究流程的每个关键步骤选择一个已配置的AI模型。</p>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label for="assign-plan" class="label">1. 规划与分解</label>
                                    <select id="assign-plan" class="input assign-select"></select>
                                </div>
                                <div>
                                    <label for="assign-filter" class="label">2. 结果筛选与分析</label>
                                    <select id="assign-filter" class="input assign-select"></select>
                                </div>
                                <div>
                                    <label for="assign-synthesize" class="label">3. 总结与报告生成</label>
                                    <select id="assign-synthesize" class="input assign-select"></select>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-4 p-4 border border-border rounded-lg">
                             <h3 class="text-lg font-semibold tracking-tight">搜索引擎 API</h3>
                             <div class="space-y-2">
                                <label for="tavily-key" class="label">Tavily API Key (通用搜索)</label>
                                <div class="relative">
                                    <input type="password" id="tavily-key" class="input pr-10" required placeholder="输入您的 Tavily Search API Key">
                                     <button type="button" class="password-toggle-btn" aria-label="Toggle Tavily Key visibility"></button>
                                </div>
                            </div>
                             <div class="space-y-2">
                                <label for="jina-key" class="label">Jina Reader API Key (网页阅读)</label>
                                <div class="relative">
                                    <input type="password" id="jina-key" class="input pr-10" placeholder="可选，用于深度阅读原文">
                                     <button type="button" class="password-toggle-btn" aria-label="Toggle Jina Key visibility"></button>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-4 p-4 border border-border rounded-lg">
                            <h3 class="text-lg font-semibold tracking-tight">AI 专家角色</h3>
                            <p class="text-sm text-muted-foreground">为AI预设一个专家角色，使其在规划搜索和撰写报告时更有针对性。</p>
                            <div class="space-y-2">
                                <label for="ai-role-select" class="label">选择角色</label>
                                <select id="ai-role-select" class="input">
                                    <option value="药物研发" selected>药物研发</option>
                                    <option value="器械研发">器械研发</option>
                                    <option value="金融分析师">金融分析师</option>
                                    <option value="市场研究员">市场研究员</option>
                                </select>
                            </div>
                        </div>

                        <div class="separator"></div>

                        <div class="space-y-4">
                            <h3 class="text-lg font-semibold tracking-tight">Google 自定义搜索引擎 (CSE)</h3>
                            <div class="alert">
                                <p class="text-sm"><b>说明：</b>添加您自己的Google CSE，并清晰描述其用途。AI将根据您的问题智能判断是否调用这些专业搜索引擎。</p>
                            </div>

                            <div id="google-cse-configs" class="space-y-4 mt-4"></div>
                             <button type="button" id="add-cse-btn" class="button button-outline button-sm w-full mt-2">
                                + 添加一组 Google CSE
                            </button>
                        </div>
                    </div>
                    <div class="card-footer flex flex-wrap gap-2 justify-between">
                        <div class="flex gap-2">
                            <button type="button" id="import-config-btn" class="button button-outline">导入配置</button>
                            <input type="file" id="import-config-input" class="hidden" accept=".json">
                            <button type="button" id="export-config-btn" class="button button-outline">导出配置</button>
                        </div>
                        <button type="submit" class="button button-primary flex-grow sm:flex-grow-0">保存配置并开始</button>
                    </div>
                </form>
            </div>
        </div>

        <div id="search-view" class="view-container hidden min-h-[80vh] flex flex-col items-center justify-center text-center">
            <div class="max-w-3xl w-full">
                <h1 class="text-4xl sm:text-5xl font-bold tracking-tighter mb-4">AI 深度研究</h1>
                <p class="text-muted-foreground mb-8 text-lg">输入一个复杂问题，AI 将为您智能规划、多源搜索、深度阅读并综合成一份精炼的研究报告。</p>
                <form id="search-form" class="w-full space-y-4">
                    <textarea id="user-question" class="textarea" placeholder="例如：分析一下最近影响半导体行业供应链的主要因素有哪些，并预测未来一年的趋势..." required></textarea>
                    <button type="submit" class="button button-primary button-lg w-full sm:w-auto">生成研究报告</button>
                </form>
                 <button id="goto-settings-btn" class="button button-ghost mt-4">配置中心</button>
            </div>
        </div>

        <div id="results-view" class="view-container hidden">
            <div class="sticky top-0 bg-background/80 backdrop-blur-sm z-10 py-4 mb-6 border-b border-border">
                <form id="new-search-form-results" class="max-w-4xl mx-auto flex items-center gap-2">
                    <input type="text" id="new-question-input" class="input flex-grow" placeholder="输入新的研究主题...">
                    <button type="submit" class="button button-primary">开始新研究</button>
                    <button type="button" id="goto-settings-btn-results" class="button button-ghost">配置</button>
                </form>
            </div>
            
            <div class="max-w-7xl mx-auto">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold tracking-tight">研究报告</h2>
                    <p id="question-display" class="text-muted-foreground mt-1"></p>
                </div>
                <div id="timeline-container" class="mb-6"></div>
                <div id="timeline-details-panel" class="card mb-6 p-4 hidden"></div>
                <div class="flex flex-col lg:flex-row gap-8">
                    <div class="lg:w-2/3 prose max-w-none" id="answer-container"></div>
                    <div class="lg:w-1/3 flex flex-col">
                        <div class="sticky top-24">
                            <h3 class="text-lg font-semibold tracking-tight text-muted-foreground mb-4 bg-background pb-2">引用来源</h3>
                            <ul id="sources-list" class="space-y-2 overflow-y-auto" style="max-height: calc(100vh - 12rem);"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js"></script>
</body>
</html>